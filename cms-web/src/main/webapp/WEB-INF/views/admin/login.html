<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <title>后台登陆</title>
    <link rel="stylesheet" href="../../../statics/admin/css/base.css"/>
    <link rel="stylesheet" href="../../../statics/admin/plug/layui_v2.3.0/css/layui.css"/>
</head>
<body class="base-body">
<div class="base-main">
    <div class="login-box">
        <header class="layui-form-item">
            xx后台登录系统
        </header>
        <form id="login-form" class="layui-form layui-form-pane">
            <div class="layui-form-item">
                <label class="layui-form-label"><i class="layui-icon layui-icon-username" style="color: #1E9FFF;"></i>
                </label>

                <div class="layui-input-inline">
                    <input type="text" name="userName" class="layui-input" lay-verify="username" placeholder="账号"
                           autocomplete="on" maxlength="20"/>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><i class="layui-icon layui-icon-password"
                                                   style="color: #1E9FFF;"></i></label>

                <div class="layui-input-inline">
                    <input type="password" name="password" class="layui-input" lay-verify="password" placeholder="密码"
                           maxlength="20"/>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><i class="layui-icon layui-icon-vercode"
                                                   style="color: #1E9FFF;"></i></label>

                <div class="layui-input-inline validate-code-box">
                    <input style="width: 88px" type="text" id="captchaInput" name="captcha" class="layui-input"
                           lay-verify="captchaInput"
                           placeholder="验证码"/>
                    <img id="captcha" style="width: 100px" src="/common/getCaptcha" title="单击刷新验证码"
                         alt="验证码">
                </div>
            </div>
            <div class="layui-form-item">
                <button type="button" class="layui-btn btn-submit" lay-submit="" lay-filter="sub">立即登录</button>
                <button id="reset" type="reset" class="layui-btn layui-btn-danger btn-reset">重置</button>
            </div>
            <div class="layui-form-item forgot-password-box">
                <!--<input type="checkbox" name="switch" title="记住密码">-->
                <a href="forget_password.html">忘记密码？</a>
            </div>
        </form>
    </div>
</div>
<script src="../../../statics/admin/plug/layui_v2.3.0/layui.js"></script>
<script type="text/javascript">
    layui.use(['jquery','form', 'layer'], function () {
        var $ = layui.jquery,form = layui.form, layer = layui.layer;
        // 验证
        form.verify({
            username: function (value) {
                if (value == "") {
                    return "请输入用户名";
                }
            },
            password: function (value) {
                if (value == "") {
                    return "请输入密码";
                }
            },
            captchaInput: function (value) {
                if (value == "") {
                    return "请输入验证码";
                }
            }
        });

        // 提交监听
        form.on('submit(sub)', function (data) {
            var jsonData = JSON.stringify(data.field);
            layer.alert(jsonData, {
                title: '最终的提交信息'
            });
            // var form=$("#login-form").serializeArray();
            $.ajax({
                url: '/admin/checkLogin',
                type: 'post',
                contentType: 'application/json',
                dataType: 'json',
                data: jsonData,
                async: true,
                success: function (data) {
                    console.log(data);
                    if (data.returnCode == "SUCCESS") {
                        // layuiSuccessMsg('登陆成功');
                        layer.msg('登陆成功');
                        window.location.href="/admin/index";
                        return false;
                    } else {
                        // layuiErrorMsg(data.returnMessage);
                        layer.msg(data.returnMessage);
                        //清空填写的数据
                        //$("#reset").click();
                        //清除填写的验证码
                        $("#captchaInput").val("");
                        //刷新验证码
                        $("#captcha").click();
                        return false;
                    }
                }
            })
            //防止页面跳转
            return false;
        });

        $(document).on('click', '#captcha', function () {
            var captchaImg = $("#captcha");
            var timestamp = (new Date()).valueOf();
            var imgSrc = "/common/getCaptcha?timestamp=" + timestamp
            captchaImg.attr("src", imgSrc);
        })

        /**错误msg提示 */
        // function layuiErrorMsg (text) {
        //     layer.msg(text, {icon: 5});
        // }
        /**成功 msg提示 */
        // function layuiSuccessMsg(text) {
        //     layer.msg(text, {icon: 6});
        // }
    })
</script>
</body>
</html>